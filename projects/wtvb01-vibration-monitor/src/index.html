<!DOCTYPE html>
<!--
################################################################################
# AutomataNexus Vibration Monitor - Desktop Application
# Enterprise-Grade ISO 10816-3 Compliant Vibration Analysis Platform
# ¬© 2025 AutomataNexus AI & AutomataControls. All rights reserved.
################################################################################
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutomataNexus Vibration Monitor - Professional Desktop Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tauri API -->
    <script>
        // Polyfill for Tauri v1 API
        if (!window.__TAURI__ && window.tauri) {
            window.__TAURI__ = window.tauri;
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fffe 0%, #e6fffa 25%, #fef7ed 50%, #eff6ff 75%, #f0f9ff 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Glass morphism title bar */
        .title-bar {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
        }
        
        .title-bar * {
            -webkit-app-region: no-drag;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.5);
        }
        
        .logo-fallback {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.5);
        }
        
        .app-title {
            font-size: 24px;
            font-weight: 300;
            color: #1a1a1a;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        
        .status-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.online {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        
        .status-dot.offline {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        .status-text {
            color: white;
            font-weight: 500;
        }
        
        /* Smooth modern tabs */
        .tab-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            padding: 0;
            position: relative;
        }
        
        .tab-nav {
            display: flex;
            gap: 0;
            overflow-x: auto;
            padding: 0 24px;
            position: relative;
        }
        
        .tab-nav::-webkit-scrollbar {
            height: 2px;
        }
        
        .tab-nav::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .tab-nav::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 1px;
        }
        
        .tab-btn {
            padding: 20px 24px;
            background: transparent;
            border: none;
            color: rgba(100, 116, 139, 1);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            letter-spacing: 0.025em;
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #14b8a6;
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-btn:hover {
            color: rgba(30, 41, 59, 1);
            background: linear-gradient(to bottom, transparent, rgba(20, 184, 166, 0.04));
        }
        
        .tab-btn.active {
            color: #14b8a6;
            font-weight: 600;
            background: linear-gradient(to bottom, rgba(20, 184, 166, 0.04), rgba(20, 184, 166, 0.08));
        }
        
        .tab-btn.active::before {
            transform: scaleX(1);
        }
        
        .tab-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-btn:hover .tab-icon {
            transform: translateY(-1px);
        }
        
        .tab-btn.active .tab-icon {
            color: #14b8a6;
            filter: drop-shadow(0 0 6px rgba(20, 184, 166, 0.4));
        }
        
        /* Tab badge */
        .tab-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            background: rgba(251, 146, 60, 0.1);
            color: #fb923c;
            margin-left: 4px;
            transition: all 0.2s ease;
        }
        
        .tab-btn.active .tab-badge {
            background: #14b8a6;
            color: white;
        }
        
        /* Content area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        .section {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        /* Ripple effect on click */
        .tab-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(20, 184, 166, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .tab-btn:active::after {
            width: 100%;
            height: 100%;
        }
        
        /* Glass cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Sensor grid */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .sensor-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.15));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sensor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #f97316, #ea580c);
        }
        
        .sensor-card.zone-a::before { background: linear-gradient(to bottom, #10b981, #059669); }
        .sensor-card.zone-b::before { background: linear-gradient(to bottom, #eab308, #ca8a04); }
        .sensor-card.zone-c::before { background: linear-gradient(to bottom, #f97316, #ea580c); }
        .sensor-card.zone-d::before { background: linear-gradient(to bottom, #ef4444, #dc2626); }
        
        .sensor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sensor-name {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .sensor-port {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .metric-value {
            color: #1a1a1a;
            font-weight: 600;
            font-size: 16px;
        }
        
        .zone-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .zone-badge.zone-a { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .zone-badge.zone-b { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .zone-badge.zone-c { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .zone-badge.zone-d { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: rgba(0, 0, 0, 0.8);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            color: #1a1a1a;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
        }
        
        /* Charts */
        .chart-container {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            height: 400px;
            position: relative;
        }
        
        /* Control panel */
        .control-panel {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        /* Status messages */
        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-message.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .status-message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        .status-message.warning {
            background: rgba(234, 179, 8, 0.2);
            border: 1px solid rgba(234, 179, 8, 0.3);
            color: #eab308;
        }
        
        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #f97316;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* No data state */
        .no-data {
            text-align: center;
            padding: 60px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .no-data-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* BMS status pill */
        .bms-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }
        
        .bms-status.enabled {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .bms-status.disabled {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="logo-section">
                <img src="automata-nexus-logo.png" class="logo-img" onerror="this.style.display='none'; document.getElementById('logo-fallback').style.display='flex';">
                <div id="logo-fallback" class="logo-fallback" style="display: none;">AN</div>
                <h1 class="app-title">AutomataNexus Vibration Monitor</h1>
            </div>
            <div class="status-section">
                <div class="connection-status">
                    <div class="status-dot online" id="status-dot"></div>
                    <span class="status-text" id="status-text">Connected</span>
                </div>
            </div>
        </div>
        
        <!-- Smooth Modern Tabs -->
        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="showTab('monitoring', this)" data-tab="monitoring">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 3v18h18"/>
                            <path d="m19 9-5 5-4-4-3 3"/>
                        </svg>
                    </span>
                    <span>Monitoring</span>
                    <span class="tab-badge" id="monitoring-badge" style="display: none;">0</span>
                </button>
                <button class="tab-btn" onclick="showTab('configuration', this)" data-tab="configuration">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/>
                        </svg>
                    </span>
                    <span>Configuration</span>
                </button>
                <button class="tab-btn" onclick="showTab('calibration', this)" data-tab="calibration">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="6"/>
                            <circle cx="12" cy="12" r="2"/>
                        </svg>
                    </span>
                    <span>Calibration</span>
                </button>
                <button class="tab-btn" onclick="showTab('bms', this)" data-tab="bms">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="9" y1="21" x2="9" y2="9"/>
                        </svg>
                    </span>
                    <span>BMS Integration</span>
                </button>
                <button class="tab-btn" onclick="showTab('analysis', this)" data-tab="analysis">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="20" x2="12" y2="10"/>
                            <line x1="18" y1="20" x2="18" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="16"/>
                        </svg>
                    </span>
                    <span>Analysis</span>
                </button>
                <button class="tab-btn" onclick="showTab('control', this)" data-tab="control">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                            <rect x="9" y="9" width="6" height="6"/>
                            <line x1="9" y1="1" x2="9" y2="4"/>
                            <line x1="15" y1="1" x2="15" y2="4"/>
                            <line x1="9" y1="20" x2="9" y2="23"/>
                            <line x1="15" y1="20" x2="15" y2="23"/>
                            <line x1="20" y1="9" x2="23" y2="9"/>
                            <line x1="20" y1="14" x2="23" y2="14"/>
                            <line x1="1" y1="9" x2="4" y2="9"/>
                            <line x1="1" y1="14" x2="4" y2="14"/>
                        </svg>
                    </span>
                    <span>Control</span>
                </button>
                <button class="tab-btn" onclick="showTab('about', this)" data-tab="about">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                    </span>
                    <span>About</span>
                </button>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Monitoring Tab -->
            <section id="monitoring" class="section active">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üî¥</span> Live Sensor Readings
                    </h2>
                    <div id="sensor-grid" class="sensor-grid">
                        <div class="no-data">
                            <div class="no-data-icon">üì°</div>
                            <p>Scanning for sensors...</p>
                            <div class="loading" style="margin-top: 20px;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üìä</span> Vibration Trends
                    </h2>
                    <div class="chart-container">
                        <canvas id="trendChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
                
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üìâ</span> FFT Analysis
                    </h2>
                    <div class="chart-container">
                        <canvas id="fftChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
            </section>
            
            <!-- Configuration Tab -->
            <section id="configuration" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üîç</span> Sensor Detection
                    </h2>
                    <div class="control-panel">
                        <button class="btn btn-primary" onclick="scanPorts()">
                            <span>üîÑ</span> Scan USB Ports
                        </button>
                        <button class="btn btn-secondary" onclick="refreshPorts()">
                            <span>‚ôªÔ∏è</span> Refresh
                        </button>
                        <button class="btn btn-success" onclick="testBackend()">
                            <span>üß™</span> Test Backend
                        </button>
                    </div>
                    <div id="port-list"></div>
                </div>
                
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>‚öôÔ∏è</span> Sensor Configuration
                    </h2>
                    <div id="config-forms"></div>
                </div>
            </section>
            
            <!-- Calibration Tab -->
            <section id="calibration" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üéØ</span> Sensor Calibration
                    </h2>
                    <div id="calibration-list">
                    <p style="color: #666;">No sensors configured yet. Configure sensors in the Configuration tab first.</p>
                </div>
                </div>
            </section>
            
            <!-- BMS Integration Tab -->
            <section id="bms" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üè¢</span> Building Management System Integration
                    </h2>
                    <div id="bms-config"></div>
                </div>
            </section>
            
            <!-- Analysis Tab -->
            <section id="analysis" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üìà</span> Advanced Analysis
                    </h2>
                    <div id="analysis-content">
                        <div class="chart-container" style="height: 500px;">
                            <canvas id="waterfallChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Control Tab -->
            <section id="control" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>üéõÔ∏è</span> System Control
                    </h2>
                    <div class="control-panel">
                        <button class="btn btn-success" onclick="startMonitoring()">
                            <span>‚ñ∂Ô∏è</span> Start Monitoring
                        </button>
                        <button class="btn btn-danger" onclick="stopMonitoring()">
                            <span>‚èπÔ∏è</span> Stop Monitoring
                        </button>
                        <button class="btn btn-secondary" onclick="exportData()">
                            <span>üíæ</span> Export Data
                        </button>
                    </div>
                    <div id="control-status"></div>
                </div>
            </section>
            
            <!-- About Tab -->
            <section id="about" class="section">
                <div class="glass-card">
                    <h2 class="card-title">
                        <span>‚ÑπÔ∏è</span> About
                    </h2>
                    <div style="color: #333; line-height: 1.8;">
                        <h3 style="margin-bottom: 15px; color: #1a1a1a;">AutomataNexus Vibration Monitor</h3>
                        <p style="margin-bottom: 10px; color: #333;">Version: 1.0.0 Alpha</p>
                        <p style="margin-bottom: 10px; color: #333;">Professional Industrial Equipment Monitoring System</p>
                        <p style="margin-bottom: 20px; color: #333;">ISO 10816-3 Compliant</p>
                        
                        <h4 style="margin-bottom: 10px; color: #1a1a1a;">Commercial License</h4>
                        <p style="margin-bottom: 10px; color: #333;">¬© 2025 AutomataNexus AI & AutomataControls</p>
                        <p style="margin-bottom: 10px; color: #333;">All rights reserved.</p>
                        <p style="margin-bottom: 20px; color: #333;">This software is commercially licensed. For licensing inquiries, contact DevOps@automatacontrols.com</p>
                        
                        <h4 style="margin-bottom: 10px; color: #1a1a1a;">Support</h4>
                        <p style="color: #333;">Email: support@automatacontrols.com</p>
                        <p style="color: #333;">Website: automatanexus.com</p>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- Configuration Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configure Sensor</h3>
                <button class="modal-close" onclick="closeModal('configModal')">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <script>
        // Tauri API detection
        let invoke;
        
        // Check multiple ways Tauri might be available
        if (typeof window !== 'undefined') {
            if (window.__TAURI_IPC__) {
                // Tauri v2 style
                console.log('[UI] Found Tauri v2 IPC');
                invoke = (cmd, args = {}) => {
                    return new Promise((resolve, reject) => {
                        window.__TAURI_IPC__({
                            cmd,
                            callback: resolve,
                            error: reject,
                            ...args
                        });
                    });
                };
            } else if (window.__TAURI__ && window.__TAURI__.invoke) {
                // Tauri v1 new style
                console.log('[UI] Found Tauri v1 invoke');
                invoke = window.__TAURI__.invoke;
            } else if (window.__TAURI__ && window.__TAURI__.tauri && window.__TAURI__.tauri.invoke) {
                // Tauri v1 old style
                console.log('[UI] Found Tauri v1 tauri.invoke');
                invoke = window.__TAURI__.tauri.invoke;
            } else if (window.tauri && window.tauri.invoke) {
                // Direct tauri object
                console.log('[UI] Found direct tauri.invoke');
                invoke = window.tauri.invoke;
            } else {
                console.log('[UI] No Tauri API found, using mock');
            // Fallback for browser testing
                invoke = async (cmd, args) => {
                    console.log('Mock invoke:', cmd, args);
                    return mockData[cmd] || {};
                };
            }
        }
        
        // Global variables
        let updateInterval;
        let trendChart, fftChart, waterfallChart;
        let sensorData = {};
        let chartData = {
            labels: [],
            datasets: []
        };
        const MAX_DATA_POINTS = 30;
        
        // Smooth tab switching with animation
        function showTab(tabName, btn) {
            // Smooth fade out current section
            const currentSection = document.querySelector('.section.active');
            if (currentSection) {
                currentSection.style.opacity = '0';
                currentSection.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    currentSection.classList.remove('active');
                    
                    // Smooth fade in new section
                    const newSection = document.getElementById(tabName);
                    newSection.classList.add('active');
                    newSection.style.opacity = '0';
                    newSection.style.transform = 'translateY(10px)';
                    
                    setTimeout(() => {
                        newSection.style.opacity = '1';
                        newSection.style.transform = 'translateY(0)';
                    }, 50);
                }, 200);
            } else {
                document.getElementById(tabName).classList.add('active');
            }
            
            // Smooth tab button transition
            document.querySelectorAll('.tab-btn').forEach(t => {
                t.classList.remove('active');
                // Reset any transforms
                t.style.transform = '';
            });
            
            btn.classList.add('active');
            
            // Add ripple effect
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            btn.appendChild(ripple);
            setTimeout(() => {
                ripple.remove();
            }, 600);
            
            // Update sensor count badge
            updateBadges();
            
            // Save active tab to localStorage
            localStorage.setItem('activeTab', tabName);
            
            // Load tab-specific data
            switch(tabName) {
                case 'monitoring':
                    startAutoUpdate();
                    break;
                case 'configuration':
                    loadConfiguration();
                    break;
                case 'calibration':
                    loadCalibration();
                    break;
                case 'bms':
                    loadBMSConfig();
                    break;
                case 'analysis':
                    loadAnalysis();
                    break;
                default:
                    stopAutoUpdate();
            }
        }
        
        // Update badge counts
        function updateBadges() {
            const sensorCount = Object.keys(sensorData).length;
            const badge = document.getElementById('monitoring-badge');
            if (badge) {
                if (sensorCount > 0) {
                    badge.textContent = sensorCount;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // Scan for USB ports (REAL implementation)
        async function scanPorts() {
            console.log('[UI] scanPorts called');
            const container = document.getElementById('port-list');
            
            // Check if invoke is available
            if (!invoke) {
                console.error('[UI] Invoke not available!');
                container.innerHTML = '<p style="color: red;">Backend not connected. Try clicking "Test Backend" first.</p>';
                return;
            }
            
            // Show loading state
            container.innerHTML = '<div class="loading"></div><p style="color: #666;">Scanning for USB ports...</p>';
            
            try {
                console.log('[UI] Calling Tauri invoke scan_ports...');
                const ports = await invoke('scan_ports', {});
                console.log('[UI] Received ports:', ports);
                
                if (!ports || ports.length === 0) {
                    container.innerHTML = `
                        <div class="no-data">
                            <p>No USB serial ports detected.</p>
                            <p style="margin-top: 10px; font-size: 14px;">Make sure your USB-to-RS485 converters are connected.</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div class="sensor-grid">
                        ${ports.map(port => `
                            <div class="sensor-card">
                                <h3 style="color: #1a1a1a; margin-bottom: 15px;">${port}</h3>
                                <p style="color: #666; font-size: 12px; margin-bottom: 10px;">${port.includes('_SIM') ? 'Simulated Sensor' : 'Physical Sensor'}</p>
                                <button class="btn btn-primary" onclick="configurePort('${port}')" style="width: 100%; margin-bottom: 10px;">
                                    Configure This Sensor
                                </button>
                                <button class="btn btn-secondary" onclick="readSensor('${port}')" style="width: 100%;">
                                    Test Read
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // Auto-read sensors on detected ports
                for (const port of ports) {
                    readSensor(port);
                }
            } catch (error) {
                console.error('Error scanning ports:', error);
                showStatus('error', 'Failed to scan ports: ' + error);
            }
        }
        
        // Read sensor data
        async function readSensor(port) {
            try {
                const reading = await invoke('read_sensor', { port });
                if (reading) {
                    sensorData[port] = reading;
                    updateSensorDisplay();
                }
            } catch (error) {
                console.error(`Error reading sensor ${port}:`, error);
            }
        }
        
        // Configure port
        function configurePort(port) {
            const modal = document.getElementById('configModal');
            const body = document.getElementById('modal-body');
            
            body.innerHTML = `
                <form onsubmit="event.preventDefault(); saveSensorConfig('${port}');">
                    <div class="form-group">
                        <label class="form-label">Sensor Name</label>
                        <input type="text" id="config-name" class="form-input" placeholder="e.g., Cooling Tower Motor 1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Equipment Type</label>
                        <select id="config-type" class="form-select" required>
                            <option value="cooling_tower_motor">Cooling Tower Motor</option>
                            <option value="centrifugal_pump">Centrifugal Pump</option>
                            <option value="reciprocating_compressor">Reciprocating Compressor</option>
                            <option value="screw_compressor">Screw Compressor</option>
                            <option value="fan_motor">Fan Motor</option>
                            <option value="general_motor">General Purpose Motor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Horsepower</label>
                        <input type="number" id="config-hp" class="form-input" placeholder="50" value="50" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Voltage</label>
                        <select id="config-voltage" class="form-select" required>
                            <option value="208">208V</option>
                            <option value="230">230V</option>
                            <option value="460">460V</option>
                            <option value="480" selected>480V</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phase</label>
                        <select id="config-phase" class="form-select" required>
                            <option value="1">Single Phase</option>
                            <option value="3" selected>Three Phase</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Save Configuration
                    </button>
                </form>
            `;
            
            modal.classList.add('show');
        }
        
        // Save sensor configuration
        async function saveSensorConfig(port) {
            const config = {
                port: port,
                name: document.getElementById('config-name').value,
                equipment_type: document.getElementById('config-type').value,
                hp: parseInt(document.getElementById('config-hp').value),
                voltage: parseInt(document.getElementById('config-voltage').value),
                phase: parseInt(document.getElementById('config-phase').value)
            };
            
            try {
                await invoke('configure_sensor', { config });
                closeModal('configModal');
                showStatus('success', `Sensor ${config.name} configured successfully!`);
                await readSensor(port); // Start reading immediately
                startAutoUpdate();
            } catch (error) {
                showStatus('error', 'Failed to configure sensor: ' + error);
            }
        }
        
        // Update sensor display
        function updateSensorDisplay() {
            const container = document.getElementById('sensor-grid');
            const sensors = Object.entries(sensorData);
            
            if (sensors.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üì°</div>
                        <p>No sensor data available.</p>
                        <p style="margin-top: 10px; font-size: 14px;">Go to Configuration tab to set up sensors.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sensors.map(([port, data]) => {
                const zoneClass = `zone-${data.iso_zone.toLowerCase()}`;
                return `
                    <div class="sensor-card ${zoneClass}">
                        <div class="sensor-header">
                            <span class="sensor-name">${data.name || port}</span>
                            <span class="sensor-port">${port}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Temperature</span>
                            <span class="metric-value">${data.temperature_f.toFixed(1)}¬∞F</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Velocity</span>
                            <span class="metric-value">${data.velocity_mms.toFixed(2)} mm/s</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">RMS Acceleration</span>
                            <span class="metric-value">${data.rms_acceleration.toFixed(4)} g</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ISO Zone</span>
                            <span class="zone-badge ${zoneClass}">${data.iso_zone}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value">${data.alert_level}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateCharts();
        }
        
        // Initialize charts
        function initCharts() {
            // Trend Chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            labels: { color: 'rgba(255, 255, 255, 0.8)' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Velocity (mm/s)',
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
            
            // FFT Chart
            const fftCtx = document.getElementById('fftChart').getContext('2d');
            fftChart = new Chart(fftCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Frequency Spectrum',
                        data: [],
                        backgroundColor: 'rgba(249, 115, 22, 0.5)',
                        borderColor: 'rgba(249, 115, 22, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: {
                        legend: {
                            labels: { color: 'rgba(255, 255, 255, 0.8)' }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Frequency (Hz)',
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amplitude',
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // Update charts
        function updateCharts() {
            if (!trendChart) return;
            
            const time = new Date().toLocaleTimeString();
            chartData.labels.push(time);
            if (chartData.labels.length > MAX_DATA_POINTS) {
                chartData.labels.shift();
            }
            
            Object.entries(sensorData).forEach(([port, data]) => {
                let dataset = chartData.datasets.find(ds => ds.label === data.name || ds.label === port);
                
                if (!dataset) {
                    const colors = ['#f97316', '#3b82f6', '#10b981', '#8b5cf6', '#ef4444', '#14b8a6'];
                    const colorIndex = chartData.datasets.length % colors.length;
                    
                    dataset = {
                        label: data.name || port,
                        data: [],
                        borderColor: colors[colorIndex],
                        backgroundColor: colors[colorIndex] + '20',
                        borderWidth: 2,
                        tension: 0.4
                    };
                    chartData.datasets.push(dataset);
                }
                
                dataset.data.push(data.velocity_mms);
                if (dataset.data.length > MAX_DATA_POINTS) {
                    dataset.data.shift();
                }
            });
            
            trendChart.update();
            
            // Update FFT with mock data
            if (fftChart && Object.keys(sensorData).length > 0) {
                const frequencies = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
                const amplitudes = frequencies.map(() => Math.random() * 5);
                
                fftChart.data.labels = frequencies;
                fftChart.data.datasets[0].data = amplitudes;
                fftChart.update();
            }
        }
        
        // Start/stop monitoring
        async function startMonitoring() {
            try {
                const result = await invoke('start_monitoring');
                showStatus('success', 'Monitoring started successfully');
                startAutoUpdate();
            } catch (error) {
                showStatus('error', 'Failed to start monitoring: ' + error);
            }
        }
        
        async function stopMonitoring() {
            try {
                const result = await invoke('stop_monitoring');
                showStatus('warning', 'Monitoring stopped');
                stopAutoUpdate();
            } catch (error) {
                showStatus('error', 'Failed to stop monitoring: ' + error);
            }
        }
        
        // Auto update
        function startAutoUpdate() {
            stopAutoUpdate();
            loadSensorData();
            updateInterval = setInterval(loadSensorData, 2000);
        }
        
        function stopAutoUpdate() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }
        
        // Load sensor data
        async function loadSensorData() {
            try {
                const readings = await invoke('get_readings');
                if (readings) {
                    sensorData = readings;
                    updateSensorDisplay();
                }
                
                // Also try to read from any new ports
                const ports = await invoke('scan_ports');
                for (const port of ports) {
                    if (!sensorData[port]) {
                        readSensor(port);
                    }
                }
            } catch (error) {
                console.error('Error loading sensor data:', error);
            }
        }
        
        // Load configuration
        async function loadConfiguration() {
            await scanPorts();
        }
        
        // Load calibration
        async function loadCalibration() {
            const container = document.getElementById('calibration-list');
            const sensors = Object.entries(sensorData);
            
            if (sensors.length === 0) {
                container.innerHTML = '<div class="no-data"><p>No sensors to calibrate. Configure sensors first.</p></div>';
                return;
            }
            
            container.innerHTML = `
                <div class="sensor-grid">
                    ${sensors.map(([port, data]) => `
                        <div class="glass-card">
                            <h3 style="color: white; margin-bottom: 20px;">${data.name || port}</h3>
                            <div class="form-group">
                                <label class="form-label">Velocity Offset (mm/s)</label>
                                <input type="number" class="form-input" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Velocity Scale Factor</label>
                                <input type="number" class="form-input" step="0.01" value="1.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Acceleration Offset (g)</label>
                                <input type="number" class="form-input" step="0.001" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Acceleration Scale Factor</label>
                                <input type="number" class="form-input" step="0.001" value="1.0">
                            </div>
                            <button class="btn btn-primary" style="width: 100%;">
                                Apply Calibration
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // Load BMS config
        function loadBMSConfig() {
            const container = document.getElementById('bms-config');
            container.innerHTML = `
                <div class="form-group">
                    <label class="form-label">BMS Server URL</label>
                    <input type="text" class="form-input" placeholder="http://bms-server:8181/api/v3/write_lp">
                </div>
                <div class="form-group">
                    <label class="form-label">Location Name</label>
                    <input type="text" class="form-input" placeholder="Building A">
                </div>
                <div class="form-group">
                    <label class="form-label">Send Interval (seconds)</label>
                    <input type="number" class="form-input" value="60">
                </div>
                <button class="btn btn-primary">Save BMS Configuration</button>
            `;
        }
        
        // Load analysis
        function loadAnalysis() {
            // Initialize waterfall chart if needed
            if (!waterfallChart) {
                const ctx = document.getElementById('waterfallChart').getContext('2d');
                waterfallChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['10Hz', '20Hz', '30Hz', '40Hz', '50Hz', '60Hz'],
                        datasets: [{
                            label: 'Waterfall Analysis',
                            data: [12, 19, 3, 5, 2, 3],
                            backgroundColor: 'rgba(249, 115, 22, 0.5)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: 'rgba(255, 255, 255, 0.8)' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            },
                            y: {
                                ticks: { color: 'rgba(255, 255, 255, 0.6)' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            }
                        }
                    }
                });
            }
        }
        
        // Export data
        function exportData() {
            const dataStr = JSON.stringify(sensorData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vibration-data-${new Date().toISOString()}.json`;
            a.click();
        }
        
        // Show status message
        function showStatus(type, message) {
            const container = document.getElementById('control-status');
            if (container) {
                container.innerHTML = `
                    <div class="status-message ${type}">
                        ${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ö†'} ${message}
                    </div>
                `;
                setTimeout(() => {
                    container.innerHTML = '';
                }, 5000);
            }
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        // Refresh ports
        function refreshPorts() {
            scanPorts();
        }
        
        // Test backend connection
        async function testBackend() {
            console.log('[UI] Testing Tauri backend...');
            console.log('[UI] invoke function:', typeof invoke);
            
            if (!invoke) {
                alert('Tauri API not available. Check console for details.');
                return;
            }
            
            try {
                console.log('[UI] Calling scan_ports...');
                const result = await invoke('scan_ports', {});
                console.log('[UI] Test successful! Got:', result);
                alert('Backend connected! Found ' + result.length + ' ports');
            } catch (error) {
                console.error('[UI] Test failed:', error);
                alert('Backend error: ' + error);
            }
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('[UI] DOM loaded, initializing...');
            console.log('[UI] window.__TAURI__:', window.__TAURI__);
            
            initCharts();
            
            // Restore last active tab
            const savedTab = localStorage.getItem('activeTab');
            if (savedTab && document.querySelector(`[data-tab="${savedTab}"]`)) {
                const tabBtn = document.querySelector(`[data-tab="${savedTab}"]`);
                showTab(savedTab, tabBtn);
            }
            
            // Initial scan for sensors
            setTimeout(() => {
                console.log('[UI] Starting initial scan...');
                console.log('[UI] invoke available:', typeof invoke);
                if (invoke) {
                    scanPorts();
                    startAutoUpdate();
                } else {
                    console.log('[UI] No invoke function, skipping scan');
                }
            }, 500);
            
            // Set up connection status
            setInterval(() => {
                const dot = document.getElementById('status-dot');
                const text = document.getElementById('status-text');
                if (Object.keys(sensorData).length > 0) {
                    dot.className = 'status-dot online';
                    text.textContent = `Connected (${Object.keys(sensorData).length} sensors)`;
                } else {
                    dot.className = 'status-dot offline';
                    text.textContent = 'No Sensors';
                }
            }, 1000);
        });
        
        // Burst read sensor - read all 19 registers in one command (fast!)
        async function burstReadSensor(port) {
            console.log('[UI] Burst reading sensor:', port);
            const startTime = Date.now();
            
            try {
                const reading = await invoke('read_sensor_burst', { port });
                const readTime = Date.now() - startTime;
                
                if (reading) {
                    sensorData[port] = reading;
                    updateSensorDisplay();
                    
                    alert(`BURST READ Complete in ${readTime}ms!\n\n` +
                          `Port: ${port}\n` +
                          `Temperature: ${reading.temperature_f.toFixed(1)}¬∞F (${reading.temperature_c.toFixed(1)}¬∞C)\n` +
                          `Velocity: ${reading.velocity_mms.toFixed(2)} mm/s\n` +
                          `Acceleration: X=${reading.accel_x.toFixed(3)}g Y=${reading.accel_y.toFixed(3)}g Z=${reading.accel_z.toFixed(3)}g\n` +
                          `Frequency: X=${reading.frequency_x.toFixed(1)}Hz Y=${reading.frequency_y.toFixed(1)}Hz Z=${reading.frequency_z.toFixed(1)}Hz\n` +
                          `ISO Zone: ${reading.iso_zone} (${reading.alert_level})\n\n` +
                          `All 19 registers read in a single Modbus command!`);
                }
            } catch (error) {
                console.error('Burst read error:', error);
                alert('Burst read failed: ' + error);
            }
        }
        
        // Optimize all sensors for maximum speed (230400 baud)
        async function optimizeAllSensors() {
            console.log('[UI] Optimizing sensors for 230400 baud...');
            
            try {
                const ports = await invoke('scan_ports', {});
                if (ports.length === 0) {
                    alert('No sensors found. Scan for ports first.');
                    return;
                }
                
                let successCount = 0;
                for (const port of ports) {
                    if (!port.includes('_SIM')) { // Only optimize real sensors
                        try {
                            const result = await invoke('optimize_for_speed', { port });
                            console.log(`[UI] Optimized ${port}: ${result}`);
                            successCount++;
                        } catch (e) {
                            console.error(`[UI] Failed to optimize ${port}:`, e);
                        }
                    }
                }
                
                alert(`Speed optimization complete!\n\n` +
                      `${successCount} sensors optimized to 230400 baud.\n` +
                      `This is 24x faster than default 9600 baud!\n\n` +
                      `Burst reading is now available for maximum performance.`);
                      
            } catch (error) {
                alert('Optimization failed: ' + error);
            }
        }
        
        // Enable high-speed mode (1000Hz sampling rate)
        async function enableHighSpeedMode() {
            console.log('[UI] Enabling 1000Hz high-speed mode...');
            
            try {
                const ports = await invoke('scan_ports', {});
                if (ports.length === 0) {
                    alert('No sensors found. Scan for ports first.');
                    return;
                }
                
                // Find first real sensor
                const realPort = ports.find(p => !p.includes('_SIM'));
                if (!realPort) {
                    alert('No physical sensors found. High-speed mode requires real WTVB01-485 sensors.');
                    return;
                }
                
                const result = await invoke('enable_high_speed_mode', { 
                    port: realPort, 
                    modbus_id: 0x50 // Default WTVB01 address
                });
                
                alert(`High-Speed Mode Enabled!\n\n` +
                      `${result}\n\n` +
                      `The sensor is now sampling at 1000Hz (1ms intervals).\n` +
                      `This requires 230400 baud rate.\n\n` +
                      `Note: Power cycle the sensor to return to normal mode.`);
                      
            } catch (error) {
                alert('Failed to enable high-speed mode: ' + error);
            }
        }
        
        // Save sensor configuration
        async function saveSensorConfig(port) {
            const config = {
                port: port,
                name: document.getElementById('config-name').value,
                equipment_type: document.getElementById('config-type').value,
                hp: parseInt(document.getElementById('config-hp').value),
                voltage: parseInt(document.getElementById('config-voltage').value),
                phase: parseInt(document.getElementById('config-phase').value),
                modbus_id: 0x50, // Default WTVB01 address
                baud_rate: 115200 // Default to optimized speed
            };
            
            try {
                await invoke('configure_sensor', config);
                closeModal('configModal');
                alert('Sensor configured successfully!');
                readSensor(port); // Read to verify configuration
            } catch (error) {
                alert('Failed to save configuration: ' + error);
            }
        }
        
        // Mock data for testing when not in Tauri
        const mockData = {
            scan_ports: ['/dev/ttyUSB0_SIM', '/dev/ttyUSB1_SIM'],
            get_readings: {
                '/dev/ttyUSB0_SIM': {
                    temperature_f: 72.5,
                    temperature_c: 22.5,
                    velocity_mms: 3.2,
                    velocity_x: 2.8,
                    velocity_y: 1.5,
                    velocity_z: 0.9,
                    rms_acceleration: 0.087,
                    accel_x: 0.02,
                    accel_y: 0.03,
                    accel_z: 1.01,
                    frequency_x: 50.0,
                    frequency_y: 60.0,
                    frequency_z: 25.0,
                    iso_zone: 'B',
                    alert_level: 'Acceptable',
                    port: '/dev/ttyUSB0_SIM',
                    name: 'Test Sensor 1'
                }
            }
        };
    </script>
</body>
</html>